/*
 * font.h — Minimal 5×7 bitmap font for SDL2 overlay (header-only)
 *
 * Covers: 0-9 A-Z a-z . : - space
 * Each glyph is 5 pixels wide × 7 pixels tall, stored as 7 bytes
 * (one byte per row, MSB-first, only bits 7..3 used for 5 columns).
 */

#ifndef AG_FONT_H
#define AG_FONT_H

#include <SDL2/SDL.h>
#include <stdint.h>

/* 5×7 glyph bitmaps — rows packed MSB-first in bits 7..3. */
static const uint8_t ag_font_glyphs[][7] = {
    /* 0x20 ' ' */ { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    /* 0x21 '.' */ { 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x60 },
    /* 0x22 ':' */ { 0x00, 0x60, 0x60, 0x00, 0x60, 0x60, 0x00 },
    /* 0x23 '-' */ { 0x00, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x00 },
    /* 0x24 '0' */ { 0x70, 0x88, 0x98, 0xA8, 0xC8, 0x88, 0x70 },
    /* 0x25 '1' */ { 0x20, 0x60, 0x20, 0x20, 0x20, 0x20, 0x70 },
    /* 0x26 '2' */ { 0x70, 0x88, 0x08, 0x10, 0x20, 0x40, 0xF8 },
    /* 0x27 '3' */ { 0xF8, 0x10, 0x20, 0x10, 0x08, 0x88, 0x70 },
    /* 0x28 '4' */ { 0x10, 0x30, 0x50, 0x90, 0xF8, 0x10, 0x10 },
    /* 0x29 '5' */ { 0xF8, 0x80, 0xF0, 0x08, 0x08, 0x88, 0x70 },
    /* 0x2A '6' */ { 0x30, 0x40, 0x80, 0xF0, 0x88, 0x88, 0x70 },
    /* 0x2B '7' */ { 0xF8, 0x08, 0x10, 0x20, 0x40, 0x40, 0x40 },
    /* 0x2C '8' */ { 0x70, 0x88, 0x88, 0x70, 0x88, 0x88, 0x70 },
    /* 0x2D '9' */ { 0x70, 0x88, 0x88, 0x78, 0x08, 0x10, 0x60 },
    /* 0x2E 'a' */ { 0x00, 0x00, 0x70, 0x08, 0x78, 0x88, 0x78 },
    /* 0x2F 'b' */ { 0x80, 0x80, 0xB0, 0xC8, 0x88, 0x88, 0xF0 },
    /* 0x30 'c' */ { 0x00, 0x00, 0x70, 0x80, 0x80, 0x88, 0x70 },
    /* 0x31 'd' */ { 0x08, 0x08, 0x68, 0x98, 0x88, 0x88, 0x78 },
    /* 0x32 'e' */ { 0x00, 0x00, 0x70, 0x88, 0xF8, 0x80, 0x70 },
    /* 0x33 'f' */ { 0x30, 0x48, 0x40, 0xE0, 0x40, 0x40, 0x40 },
    /* 0x34 'g' */ { 0x00, 0x78, 0x88, 0x88, 0x78, 0x08, 0x70 },
    /* 0x35 'h' */ { 0x80, 0x80, 0xB0, 0xC8, 0x88, 0x88, 0x88 },
    /* 0x36 'i' */ { 0x20, 0x00, 0x60, 0x20, 0x20, 0x20, 0x70 },
    /* 0x37 'j' */ { 0x10, 0x00, 0x30, 0x10, 0x10, 0x90, 0x60 },
    /* 0x38 'k' */ { 0x80, 0x80, 0x90, 0xA0, 0xC0, 0xA0, 0x90 },
    /* 0x39 'l' */ { 0x60, 0x20, 0x20, 0x20, 0x20, 0x20, 0x70 },
    /* 0x3A 'm' */ { 0x00, 0x00, 0xD0, 0xA8, 0xA8, 0x88, 0x88 },
    /* 0x3B 'n' */ { 0x00, 0x00, 0xB0, 0xC8, 0x88, 0x88, 0x88 },
    /* 0x3C 'o' */ { 0x00, 0x00, 0x70, 0x88, 0x88, 0x88, 0x70 },
    /* 0x3D 'p' */ { 0x00, 0x00, 0xF0, 0x88, 0xF0, 0x80, 0x80 },
    /* 0x3E 'q' */ { 0x00, 0x00, 0x68, 0x98, 0x78, 0x08, 0x08 },
    /* 0x3F 'r' */ { 0x00, 0x00, 0xB0, 0xC8, 0x80, 0x80, 0x80 },
    /* 0x40 's' */ { 0x00, 0x00, 0x78, 0x80, 0x70, 0x08, 0xF0 },
    /* 0x41 't' */ { 0x40, 0x40, 0xE0, 0x40, 0x40, 0x48, 0x30 },
    /* 0x42 'u' */ { 0x00, 0x00, 0x88, 0x88, 0x88, 0x98, 0x68 },
    /* 0x43 'v' */ { 0x00, 0x00, 0x88, 0x88, 0x88, 0x50, 0x20 },
    /* 0x44 'w' */ { 0x00, 0x00, 0x88, 0x88, 0xA8, 0xA8, 0x50 },
    /* 0x45 'x' */ { 0x00, 0x00, 0x88, 0x50, 0x20, 0x50, 0x88 },
    /* 0x46 'y' */ { 0x00, 0x00, 0x88, 0x88, 0x78, 0x08, 0x70 },
    /* 0x47 'z' */ { 0x00, 0x00, 0xF8, 0x10, 0x20, 0x40, 0xF8 },
};

/* Map ASCII character to glyph index, or -1 if unsupported. */
static inline int
ag_font_index (char c)
{
    if (c == ' ')                  return 0;
    if (c == '.')                  return 1;
    if (c == ':')                  return 2;
    if (c == '-')                  return 3;
    if (c >= '0' && c <= '9')     return 4 + (c - '0');
    if (c >= 'a' && c <= 'z')     return 14 + (c - 'a');
    if (c >= 'A' && c <= 'Z')     return 14 + (c - 'A');  /* uppercase→lowercase */
    return -1;
}

/*
 * Render a text string onto an SDL renderer using the bitmap font.
 * Each pixel is drawn as a (scale × scale) filled rectangle.
 * Glyph spacing: 6 × scale pixels (5 glyph + 1 gap).
 */
static inline void
ag_font_render (SDL_Renderer *renderer, const char *text,
                int x, int y, int scale,
                uint8_t r, uint8_t g, uint8_t b)
{
    SDL_SetRenderDrawColor (renderer, r, g, b, 255);

    int cx = x;
    for (const char *p = text; *p; p++) {
        int idx = ag_font_index (*p);
        if (idx < 0) {
            cx += 6 * scale;
            continue;
        }

        const uint8_t *glyph = ag_font_glyphs[idx];
        for (int row = 0; row < 7; row++) {
            uint8_t bits = glyph[row];
            for (int col = 0; col < 5; col++) {
                if (bits & (0x80 >> col)) {
                    SDL_Rect rc = {
                        cx + col * scale,
                        y  + row * scale,
                        scale, scale
                    };
                    SDL_RenderFillRect (renderer, &rc);
                }
            }
        }
        cx += 6 * scale;
    }
}

#endif /* AG_FONT_H */
